---
lab:
  title: 'ラボ 02a: サブスクリプションと RBAC を管理する'
  module: Administer Governance and Compliance
---

# ラボ 02a - サブスクリプションと RBAC を管理する

## ラボ概要

このラボでは、ロールベースのアクセス制御について説明します。 アクセス許可とスコープを使用して、ID が実行できるアクションと実行できないアクションを制御する方法について説明します。 また、管理グループを使用してサブスクリプション管理を容易にする方法についても説明します。 

## 推定時間:30 分

## ラボのシナリオ

組織内の Azure リソースの管理を簡素化するために、次の機能を実装する必要があります。

- すべての Azure サブスクリプションを含む管理グループを作成する。

- 管理グループ内のすべてのサブスクリプションに対するサポート リクエストを提出するためのアクセス許可を付与する。 アクセス許可は、次の場合に限定する必要があります。 

    - 仮想マシンの作成と管理
    - サポート リクエスト チケットを作成する (Azure プロバイダーの追加を含まない)

## アーキテクチャ図

![ラボのタスクの図。](./media/az104-lab02a-architecture.png)

## 実施するタスク

+ タスク 1:管理グループを実装する。
+ タスク 2:組み込みの Azure ロールを確認して割り当てる。
+ タスク 3:カスタム RBAC ロールを作成する。
+ タスク 4:アクティビティ ログを使用してロールの割り当てを監視する。

## タスク 1:管理グループを実装する

このタスクでは、管理グループを作成および構成します。 管理グループは、サブスクリプションを論理的に整理するために使用されます。 サブスクリプションをセグメント化し、RBAC と Azure Policy を割り当て、他の管理グループとサブスクリプションに継承できるようにする必要があります。 たとえば、組織にヨーロッパ専用のサポート チームがある場合は、ヨーロッパのサブスクリプションを 1 つの管理グループに編成して、(すべてのサブスクリプションへの個別のアクセス権を提供することなく) サポート スタッフがそれらのサブスクリプションにアクセスできるようにします。 このシナリオでは、ヘルプ デスクの全員が、すべてのサブスクリプションにわたるサポート リクエストを作成する必要があります。 

1. [**Azure portal**](https://portal.azure.com) にサインインします。

1. `Microsoft Entra ID` を検索して選択します。

1. **[管理]** セクションから **[プロパティ]** を選択します。

1. **[Azure リソースのアクセス管理]** 領域を確認します。 このテナント内のすべての Azure サブスクリプションおよび管理グループへのアクセスを管理できることを確実にします。
   
1. **管理グループ** を検索して選択します。

1. **[管理グループ]** ブレードで、**[+ 作成]** をクリックします。

1. 次の設定で管理グループを作成します。 完了したら、**[submit]** を選択します。 

    | 設定 | [値] |
    | --- | --- |
    | 管理グループ ID | `az104-mgXXXXXXXX` <br />※XにはLabUser-XXXXXXXXと同じ8桁の数字を入力します。(あるいはランダムで一意な数字) |
    | 管理グループの表示名 | `az104-mg1` |

1. 管理グループのページを**更新**して、新しい管理グループが表示されていることを確認します。作成されるまでに時間がかかる場合があります。 


## タスク 2:組み込みの Azure ロールを確認して割り当てる

このタスクでは、組み込みロールを確認し、VM 共同作成者ロールをヘルプ デスクのメンバーに割り当てます。 Azure には、多数の[組み込みロール](https://learn.microsoft.com/azure/role-based-access-control/built-in-roles)が用意されています。 

1. **az104-mg1** 管理グループを選択します。

1. **[アクセス制御 (IAM)]** ブレードを選択してから、**[役割]** タブを選択します。

1. 使用可能な組み込みのロール（役割）の定義を確認します。 各ロールの詳細列にある **[ビュー]** をクリックすることで、アクセス許可、JSON形式での定義、および割り当てに関する詳細情報を見ることができます。主に使用されるロールには、*所有者*、*共同作成者*、*閲覧者*などがあります。 

1.  **[+ 追加]** をクリックして、ドロップダウンリストから **[ロールの割り当ての追加]** を選択します。 

1.  **[ロールの割り当ての追加]** ブレードで、**[仮想マシン共同作成者]** を検索して選択します。 仮想マシン共同作成者のロールでは仮想マシンを管理できますが、そのオペレーティング システムにアクセスしたり、接続先の仮想ネットワークやストレージ アカウントを管理したりすることはできません。 これはヘルプデスクのメンバーなどに適切なロールです。 [**次へ**] を選択します。

1. **[メンバー]** タブで **[+ メンバーを選択する]** を行います。

    >**注:**  次の手順では、**ヘルプデスク** グループにロールを割り当てます。 ヘルプ デスク グループがない場合は、少し時間を取って作成します。

1. `helpdesk` グループを検索して選択します。 **[選択]** をクリックします。 

1. **[レビューと割り当て]** を 2 回クリックして、ロールの割り当てを作成します。

1. **[アクセス制御 (IAM)]** ブレードの操作を続行します。 **[ロールの割り当て]** タブで、**helpdesk** グループに**仮想マシン共同作成者**ロールがあることを確認します。 

    >**注:**  ベスト プラクティスとして、常に個人ではなくグループにロールを割り当てることが推奨されています。個人に割り当てた場合は、職責に合わせたロールの割り当てや割り当て解除の作業が煩雑になることが予想されます。 

## タスク 3:カスタム RBAC ロールを作成する

このタスクでは、カスタム RBAC ロールを作成します。 カスタム ロールは、環境に対する最小特権の原則の実装に関する中心的な部分です。 ご自分のシナリオでは、組み込みロールにあるアクセス許可が多すぎる場合があります。 このタスクでは、新しいロールを作成し、不要なアクセス許可を削除します。 重複するアクセス許可を管理する計画はありますか?

1. 管理グループの作業を続行します。 **[アクセス制御 (IAM)]** ブレードで、**[アクセスの確認]** タブを選択します。

1. **[カスタム ロールを作成する]** ボックスで、**[追加]** を選択します。

1. [基本] タブで、構成を完了します。

    | 設定 | 値 |
    | --- | --- |
    | カスタム ロール名 | Custom Support Request(XXXXXXXX) <br />※XにはLabUser-XXXXXXXXと同じ8桁の数字を入力します。(あるいはランダムで一意な数字) |
    | 説明 | サポート リクエストのカスタム共同作成者ロール |

1. **[ベースラインのアクセス許可]** で、**[ロールを複製します]** を選択します。 **[複製するロール]** ドロップダウン メニューで、**[サポート リクエスト共同作成者]** を選択します。

1. **[次へ]** を選択して **[アクセス許可]** タブに移動し、**[+ 権限を除外する]** を選択します。

1. リソース プロバイダーの検索フィールドで、`.Support` と入力して **Microsoft.Support** を選択します。

1. アクセス許可の一覧で、**[その他: Registers Support Resource Provider ]** のチェックボックスにチェックを入れ、**[追加]** を選択します。 

1. **[割り当て可能なスコープ]** タブで、管理グループが表示されていることを確認し、**[次へ]** をクリックします。

1. ロールでカスタマイズされた *actions*、*notActions*、*assignableScopes* を JSON で確認します。 

1. **[確認と作成]**、**[作成]** の順に選択します。

    >**注:**  これでカスタム ロールを作成し、管理グループに割り当て可能になりました。  

## タスク 4:アクティビティ ログを使用してロールの割り当てを監視する

このタスクでは、アクティビティ ログを表示して、誰かが新しいロールを作成したかどうかを判別します。 

1. ポータルで **az104-mg1** リソースを見つけて、**[動作状況ログ]** を選択します。 ログを見ると、サブスクリプションレベルのイベントに関する分析情報が得られます。 

1. ロールの割り当てのアクティビティを確認します。 アクティビティ ログは、特定の操作についてフィルター処理できます。 


## 要点

以上でラボは完了です。 このラボの要点は次のとおりです。 

+ 管理グループは、サブスクリプションを論理的に整理するために使用されます。
+ 組み込みのルート管理グループには、すべての管理グループとサブスクリプションが含まれています。
+ Azure には多数の組み込みロールがあります。 これらのロールを割り当てて、リソースへのアクセスを制御できます。
+ 新しいロールを作成することも、既存のロールをカスタマイズすることもできます。
+ ロールは JSON 形式のファイルで定義され、*Actions*、*NotActions*、*AssignableScopes* が含まれます。
+ アクティビティ ログを使用して、ロールの割り当てを監視できます。 

## 自習トレーニングでさらに学習する

+ [Azure ロールベースのアクセス制御 (Azure RBAC) で Azure リソースをセキュリティ保護する](https://learn.microsoft.com/training/modules/secure-azure-resources-with-rbac/)。 Azure RBAC を使用して、Azure のリソースへのアクセスを管理します。
+ [ロールベースのアクセス制御 (RBAC) を使用して Azure リソースのカスタム ロールを作成する](https://learn.microsoft.com/training/modules/create-custom-azure-roles-with-rbac/)。 アクセス制御のロール定義の構造を理解します。 カスタム ロールのアクセス許可を定義するために使用するロールのプロパティを特定します。 Azure カスタム ロールを作成し、ユーザーに割り当てます。





